@{
    ViewData["Title"] = "Public Officials Dashboard";
}

<div class="container mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">Check Out What Your Public Officials Are Up To</h1>
        <p class="text-lg text-gray-600">Real-time insights into congressional trading, government contracts, lobbying activities, and more.</p>
        
        <div class="mt-6 flex flex-wrap gap-4">
            <button id="refreshData" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
                <i class="fas fa-sync-alt mr-2"></i>Refresh Data
            </button>
            <button id="toggleMockData" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg transition-colors">
                <i class="fas fa-toggle-on mr-2"></i>Toggle Mock Data
            </button>
            <div id="apiStatus" class="px-4 py-2 rounded-lg text-sm font-medium"></div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
        <!-- Historical Congress Trading Card -->
        <div id="historicalCongressTradingCard" class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold text-gray-900">Historical Congress Trading</h3>
                <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>
            </div>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Trades:</span>
                    <span id="congressTotalTrades" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Volume:</span>
                    <span id="congressTotalVolume" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Active Traders:</span>
                    <span id="congressActiveTraders" class="font-semibold">-</span>
                </div>
                <div class="text-xs text-gray-500 mt-2">
                    Last updated: <span id="congressLastUpdated">-</span>
                </div>
            </div>
        </div>

        <!-- Government Contracts Card -->
        <div id="governmentContractsCard" class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold text-gray-900">Government Contracts</h3>
                <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
            </div>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Contracts:</span>
                    <span id="contractsTotal" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Value:</span>
                    <span id="contractsValue" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Active Companies:</span>
                    <span id="contractsCompanies" class="font-semibold">-</span>
                </div>
                <div class="text-xs text-gray-500 mt-2">
                    Last updated: <span id="contractsLastUpdated">-</span>
                </div>
            </div>
        </div>

        <!-- House Trading Card -->
        <div id="houseTradingCard" class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold text-gray-900">House Trading</h3>
                <div class="w-3 h-3 bg-purple-500 rounded-full animate-pulse"></div>
            </div>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Trades:</span>
                    <span id="houseTotalTrades" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Volume:</span>
                    <span id="houseTotalVolume" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Active Traders:</span>
                    <span id="houseActiveTraders" class="font-semibold">-</span>
                </div>
                <div class="text-xs text-gray-500 mt-2">
                    Last updated: <span id="houseLastUpdated">-</span>
                </div>
            </div>
        </div>

        <!-- Lobbying Activity Card -->
        <div id="lobbyingActivityCard" class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-orange-500">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold text-gray-900">Lobbying Activity</h3>
                <div class="w-3 h-3 bg-orange-500 rounded-full animate-pulse"></div>
            </div>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Reports:</span>
                    <span id="lobbyingReports" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Spending:</span>
                    <span id="lobbyingSpending" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Active Firms:</span>
                    <span id="lobbyingFirms" class="font-semibold">-</span>
                </div>
                <div class="text-xs text-gray-500 mt-2">
                    Last updated: <span id="lobbyingLastUpdated">-</span>
                </div>
            </div>
        </div>

        <!-- Senator Trading Card -->
        <div id="senatorTradingCard" class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold text-gray-900">Senator Trading</h3>
                <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
            </div>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Trades:</span>
                    <span id="senatorTotalTrades" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Volume:</span>
                    <span id="senatorTotalVolume" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Active Traders:</span>
                    <span id="senatorActiveTraders" class="font-semibold">-</span>
                </div>
                <div class="text-xs text-gray-500 mt-2">
                    Last updated: <span id="senatorLastUpdated">-</span>
                </div>
            </div>
        </div>

        <!-- Patent Momentum Card -->
        <div id="patentMomentumCard" class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-indigo-500">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold text-gray-900">Patent Momentum</h3>
                <div class="w-3 h-3 bg-indigo-500 rounded-full animate-pulse"></div>
            </div>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Total Patents:</span>
                    <span id="patentsTotal" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Active Patents:</span>
                    <span id="patentsActive" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Pending Patents:</span>
                    <span id="patentsPending" class="font-semibold">-</span>
                </div>
                <div class="text-xs text-gray-500 mt-2">
                    Last updated: <span id="patentsLastUpdated">-</span>
                </div>
            </div>
        </div>

        <!-- Market Sentiment Card -->
        <div id="marketSentimentCard" class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-teal-500">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold text-gray-900">Market Sentiment</h3>
                <div class="w-3 h-3 bg-teal-500 rounded-full animate-pulse"></div>
            </div>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-gray-600">Sentiment:</span>
                    <span id="sentimentOverall" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Score:</span>
                    <span id="sentimentScore" class="font-semibold">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600">Indicators:</span>
                    <span id="sentimentIndicators" class="font-semibold">-</span>
                </div>
                <div class="text-xs text-gray-500 mt-2">
                    Last updated: <span id="sentimentLastUpdated">-</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Summary Section -->
    <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Summary & Insights</h2>
        <div id="summaryContent" class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="text-center">
                <div class="text-3xl font-bold text-blue-600" id="totalDataPoints">-</div>
                <div class="text-sm text-gray-600">Total Data Points</div>
            </div>
            <div class="text-center">
                <div class="text-3xl font-bold text-green-600" id="complianceScore">-</div>
                <div class="text-sm text-gray-600">Compliance Score</div>
            </div>
            <div class="text-center">
                <div class="text-3xl font-bold text-red-600" id="riskLevel">-</div>
                <div class="text-sm text-gray-600">Risk Level</div>
            </div>
        </div>
        <div id="insightsList" class="mt-6 space-y-2"></div>
    </div>
</div>

@section Scripts {
    <script>
        let useMockData = false;
        let refreshInterval;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            checkApiStatus();
            startAutoRefresh();
        });

        // Load all data
        async function loadAllData() {
            try {
                const response = await fetch(`/api/PublicOfficials/all-cards?useMockData=${useMockData}`);
                if (response.ok) {
                    const data = await response.json();
                    updateAllCards(data);
                } else {
                    console.error('Failed to load data');
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Update all cards with data
        function updateAllCards(data) {
            // Historical Congress Trading
            if (data.HistoricalCongressTrading) {
                document.getElementById('congressTotalTrades').textContent = data.HistoricalCongressTrading.totalTrades.toLocaleString();
                document.getElementById('congressTotalVolume').textContent = formatCurrency(data.HistoricalCongressTrading.totalVolume);
                document.getElementById('congressActiveTraders').textContent = data.HistoricalCongressTrading.activeTraders;
                document.getElementById('congressLastUpdated').textContent = formatDateTime(data.HistoricalCongressTrading.lastUpdated);
            }

            // Government Contracts
            if (data.GovernmentContracts) {
                document.getElementById('contractsTotal').textContent = data.GovernmentContracts.totalContracts.toLocaleString();
                document.getElementById('contractsValue').textContent = formatCurrency(data.GovernmentContracts.totalValue);
                document.getElementById('contractsCompanies').textContent = data.GovernmentContracts.activeCompanies;
                document.getElementById('contractsLastUpdated').textContent = formatDateTime(data.GovernmentContracts.lastUpdated);
            }

            // House Trading
            if (data.HouseTrading) {
                document.getElementById('houseTotalTrades').textContent = data.HouseTrading.totalTrades.toLocaleString();
                document.getElementById('houseTotalVolume').textContent = formatCurrency(data.HouseTrading.totalVolume);
                document.getElementById('houseActiveTraders').textContent = data.HouseTrading.activeTraders;
                document.getElementById('houseLastUpdated').textContent = formatDateTime(data.HouseTrading.lastUpdated);
            }

            // Lobbying Activity
            if (data.LobbyingActivity) {
                document.getElementById('lobbyingReports').textContent = data.LobbyingActivity.totalReports.toLocaleString();
                document.getElementById('lobbyingSpending').textContent = formatCurrency(data.LobbyingActivity.totalSpending);
                document.getElementById('lobbyingFirms').textContent = data.LobbyingActivity.activeFirms;
                document.getElementById('lobbyingLastUpdated').textContent = formatDateTime(data.LobbyingActivity.lastUpdated);
            }

            // Senator Trading
            if (data.SenatorTrading) {
                document.getElementById('senatorTotalTrades').textContent = data.SenatorTrading.totalTrades.toLocaleString();
                document.getElementById('senatorTotalVolume').textContent = formatCurrency(data.SenatorTrading.totalVolume);
                document.getElementById('senatorActiveTraders').textContent = data.SenatorTrading.activeTraders;
                document.getElementById('senatorLastUpdated').textContent = formatDateTime(data.SenatorTrading.lastUpdated);
            }

            // Patent Momentum
            if (data.PatentMomentum) {
                document.getElementById('patentsTotal').textContent = data.PatentMomentum.totalPatents.toLocaleString();
                document.getElementById('patentsActive').textContent = data.PatentMomentum.activePatents.toLocaleString();
                document.getElementById('patentsPending').textContent = data.PatentMomentum.pendingPatents.toLocaleString();
                document.getElementById('patentsLastUpdated').textContent = formatDateTime(data.PatentMomentum.lastUpdated);
            }

            // Market Sentiment
            if (data.MarketSentiment) {
                document.getElementById('sentimentOverall').textContent = data.MarketSentiment.overallSentiment;
                document.getElementById('sentimentScore').textContent = data.MarketSentiment.sentimentScore;
                document.getElementById('sentimentIndicators').textContent = data.MarketSentiment.marketIndicators?.length || 0;
                document.getElementById('sentimentLastUpdated').textContent = formatDateTime(data.MarketSentiment.lastUpdated);
            }

            // Load summary data
            loadSummaryData();
        }

        // Load summary data
        async function loadSummaryData() {
            try {
                const response = await fetch(`/api/PublicOfficials/summary?useMockData=${useMockData}`);
                if (response.ok) {
                    const summary = await response.json();
                    updateSummary(summary);
                }
            } catch (error) {
                console.error('Error loading summary:', error);
            }
        }

        // Update summary section
        function updateSummary(summary) {
            document.getElementById('totalDataPoints').textContent = summary.totalDataPoints?.toLocaleString() || '-';
            document.getElementById('complianceScore').textContent = summary.overallComplianceScore?.toFixed(1) + '%' || '-';
            document.getElementById('riskLevel').textContent = summary.overallRiskLevel || '-';

            // Update insights
            const insightsList = document.getElementById('insightsList');
            insightsList.innerHTML = '';
            
            if (summary.insights && summary.insights.length > 0) {
                summary.insights.forEach(insight => {
                    const insightDiv = document.createElement('div');
                    insightDiv.className = 'p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400';
                    insightDiv.innerHTML = `
                        <div class="font-medium text-blue-900">${insight.title}</div>
                        <div class="text-sm text-blue-700">${insight.description}</div>
                    `;
                    insightsList.appendChild(insightDiv);
                });
            }
        }

        // Check API status
        async function checkApiStatus() {
            try {
                const response = await fetch('/api/PublicOfficials/api-access');
                if (response.ok) {
                    const status = await response.json();
                    const statusDiv = document.getElementById('apiStatus');
                    
                    if (status.hasApiAccess) {
                        statusDiv.className = 'px-4 py-2 rounded-lg text-sm font-medium bg-green-100 text-green-800';
                        statusDiv.textContent = '✓ Quiver API Connected';
                    } else {
                        statusDiv.className = 'px-4 py-2 rounded-lg text-sm font-medium bg-red-100 text-red-800';
                        statusDiv.textContent = '✗ Quiver API Not Available';
                    }
                }
            } catch (error) {
                console.error('Error checking API status:', error);
            }
        }

        // Refresh data from Quiver API
        async function refreshData() {
            try {
                const response = await fetch('/api/PublicOfficials/refresh', { method: 'POST' });
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        loadAllData();
                        showNotification('Data refreshed successfully!', 'success');
                    } else {
                        showNotification('Failed to refresh data', 'error');
                    }
                }
            } catch (error) {
                console.error('Error refreshing data:', error);
                showNotification('Error refreshing data', 'error');
            }
        }

        // Toggle mock data
        function toggleMockData() {
            useMockData = !useMockData;
            const button = document.getElementById('toggleMockData');
            if (useMockData) {
                button.innerHTML = '<i class="fas fa-toggle-off mr-2"></i>Using Mock Data';
                button.className = 'bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded-lg transition-colors';
            } else {
                button.innerHTML = '<i class="fas fa-toggle-on mr-2"></i>Using Live Data';
                button.className = 'bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg transition-colors';
            }
            loadAllData();
        }

        // Start auto-refresh
        function startAutoRefresh() {
            refreshInterval = setInterval(() => {
                if (!useMockData) {
                    loadAllData();
                }
            }, 300000); // Refresh every 5 minutes
        }

        // Utility functions
        function formatCurrency(amount) {
            if (amount >= 1000000000) {
                return '$' + (amount / 1000000000).toFixed(1) + 'B';
            } else if (amount >= 1000000) {
                return '$' + (amount / 1000000).toFixed(1) + 'M';
            } else if (amount >= 1000) {
                return '$' + (amount / 1000).toFixed(1) + 'K';
            }
            return '$' + amount.toFixed(0);
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString();
        }

        function showNotification(message, type) {
            // Simple notification - you can enhance this with a proper toast library
            alert(message);
        }

        // Event listeners
        document.getElementById('refreshData').addEventListener('click', refreshData);
        document.getElementById('toggleMockData').addEventListener('click', toggleMockData);

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });
    </script>
}
